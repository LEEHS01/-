# GitLab Runner CI/CD
image: tmaier/docker-compose:latest
# services:
#  - docker:dind
stages:
  - build
  - deploy

before_script:
  - echo "Login Docker Registry..."
  - echo $CI_REGISTRY_USER
  - echo $CI_REGISTRY_PASSWORD
  - echo $CI_REGISTRY
  - docker login -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD $CI_REGISTRY    # docker registry 로그인

build-job:
  stage: build
  script:
    - echo "Build docker image..."
    - docker build -t $CI_REGISTRY/$CI_PROJECT_PATH:latest .     # docker build
    - docker push $CI_REGISTRY/$CI_PROJECT_PATH:latest           # docker image push
    
step-deploy-prod:
  stage: deploy
  before_script:
  - docker-compose --version
  - docker info
  script:
    - docker-compose up -d --build
    
